package me.robeart.raion.client.module.exploit;

//import com.sun.xml.internal.bind.v2.runtime.reflect.Lister;

import me.robeart.raion.client.events.EventStageable;
import me.robeart.raion.client.events.events.network.PacketSendEvent;
import me.robeart.raion.client.module.Module;
import net.minecraft.network.NetworkManager;
import net.minecraft.network.play.client.CPacketChatMessage;
import team.stiff.pomelo.impl.annotated.handler.annotation.Listener;

/**
 * @author Robeart
 */
public class NetHandlerModule extends Module {
	
	public NetworkManager handler;
	
	public NetHandlerModule() {
		super("NetHandler", "Changes SPacketChat NetHandler to the current NetHandler after softLeave", Category.EXPLOIT);
	}
	
	@Override
	public void onEnable() {
		if (mc.getConnection() != null) this.handler = mc.getConnection().getNetworkManager();
	}
	
	@Listener
	public void onPacketSend(PacketSendEvent event) {
		if (event.getStage() != EventStageable.EventStage.PRE) return;
		if (event.getPacket() instanceof CPacketChatMessage) {
			if (event.getNetworkManager() != handler) {
				handler.sendPacket(event.getPacket());
				event.setCanceled(true);
			}
		}
	}
}
